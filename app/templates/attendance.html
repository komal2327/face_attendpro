<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Face Attendance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #185a9d 0%, #ff512f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .attendance-card {
            background: rgba(255,255,255,0.97);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            padding: 2.5rem 2rem;
            max-width: 500px;
            width: 100%;
            position: relative;
        }
        .attendance-card h2 {
            color: #ff512f;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }
    </style>
    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    document.getElementById('latitude').value = position.coords.latitude;
                    document.getElementById('longitude').value = position.coords.longitude;
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        window.onload = getLocation;
    </script>
</head>
<body>
    <div class="attendance-card">
        <h2>Face Attendance</h2>
        <form method="POST" action="/attendance" enctype="multipart/form-data" id="attendanceForm">
            <input type="hidden" id="subject" name="subject" value="{{ subject }}">
            <input type="hidden" id="date" name="date" value="{{ date }}">
            <input type="hidden" id="teacher" name="teacher" value="{{ teacher }}">
            <input type="hidden" id="latitude" name="latitude">
            <input type="hidden" id="longitude" name="longitude">
            <div class="mb-3">
                <label class="form-label">Live Face Scanner</label>
                <div id="camera-container" style="text-align:center;">
                    <video id="video" width="320" height="240" autoplay style="border-radius:12px; background:#eee;"></video>
                    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
                    <br>
                    <button type="button" class="btn btn-info mt-2" onclick="captureFace()">Capture Face</button>
                </div>
                <input type="file" id="face_image" name="face_image" accept="image/*" style="display:none;">
                <div id="preview" class="mt-2"></div>
            </div>
            <button type="submit" class="btn btn-primary w-100">Submit Attendance</button>
        </form>
    </div>
    <script>
        // Webcam setup
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const faceInput = document.getElementById('face_image');
        const preview = document.getElementById('preview');
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => { alert('Could not access webcam.'); });

        function captureFace() {
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            canvas.toBlob(function(blob) {
                // Show preview
                const url = URL.createObjectURL(blob);
                preview.innerHTML = `<img src='${url}' width='160' height='120' class='rounded'>`;
                // Create a File object and set it to the hidden input
                const file = new File([blob], 'face.png', { type: 'image/png' });
                // Use DataTransfer to set file input
                const dt = new DataTransfer();
                dt.items.add(file);
                faceInput.files = dt.files;
            }, 'image/png');
        }
    </script>
</body>
</html>
